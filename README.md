# We-Dear 医患沟通系统需求设计书

## 1. 项目概述

We-Dear 是一个医患沟通系统,旨在提供医生和患者之间的即时沟通平台,并集成 AI 辅助功能来提供智能建议。

## 2. 系统架构

### 2.1 技术栈
- 后端: Go + Gin 框架
- 数据存储: CSV 文件存储(当前)
- AI 服务: OpenAI API

### 2.2 核心模块
- 患者管理
- 消息系统
- AI 建议
- 病历管理
- 文件附件

## 3. 功能需求

### 3.1 患者管理
- 患者信息的 CRUD
- 患者基本信息包含:姓名、性别、年龄、生日、联系方式等
- 患者医疗信息包含:血型、过敏史、慢性病史等

### 3.2 消息系统
- 支持医生-患者双向即时通讯
- 消息类型:文本、图片、语音、文件
- 消息状态追踪(已读/未读)
- 消息历史记录

### 3.3 AI 建议
- 基于患者信息和对话历史生成建议
- 建议分类:用药建议、就医建议、生活建议、紧急建议
- 建议优先级分级(1-5级)
- 建议审核流程

### 3.4 病历管理
- 病历记录的创建和管理
- 包含:诊断、治疗方案、处方等信息
- 病历状态追踪

### 3.5 文件系统
- 支持多种类型附件上传
- 文件分类管理
- 安全访问控制

## 4. 数据模型

### 4.1 核心实体
- Patient (患者)
- Message (消息)
- AISuggestion (AI建议)
- MedicalRecord (病历)
- Attachment (附件)
- Doctor (医生)
- Department (科室)

## 5. 优化建议

### 5.1 架构优化
1. 数据存储升级
   - 建议从CSV文件存储迁移到关系型数据库(如PostgreSQL)
   - 考虑使用Redis缓存热点数据

2. 服务拆分
   - 将AI服务独立部署
   - 消息系统可考虑使用消息队列(如RabbitMQ)

### 5.2 性能优化
1. 消息系统
   - 实现WebSocket长连接
   - 消息分页加载
   - 历史消息缓存策略

2. AI服务
   - 建立模型响应缓存
   - 实现请求队列和限流
   - 优化提示词工程

### 5.3 安全性优化
1. 身份认证
   - 实现完整的JWT认证
   - 细化权限控制系统

2. 数据安全
   - 实现数据加密存储
   - 完善敏感信息脱敏
   - 增加操作日志审计

### 5.4 代码优化
1. 错误处理
   - 统一错误码管理
   - 完善错误日志记录

2. 接口优化
   - 增加接口版本控制
   - 规范化API文档
   - 增加接口限流

3. 测试覆盖
   - 补充单元测试
   - 添加集成测试
   - 压力测试方案

### 5.5 业务优化
1. AI建议系统
   - 完善建议分类算法
   - 增加建议准确度评估
   - 建立医生反馈机制

2. 患者管理
   - 增加患者分类标签
   - 完善患者画像系统
   - 添加随访提醒功能

## 6. 后续规划

### 6.1 近期目标
- 数据库迁移方案
- WebSocket实现
- 单元测试覆盖
- 安全认证体系

### 6.2 中期目标
- 服务拆分
- 缓存系统建设
- 监控告警体系
- 容器化部署

### 6.3 远期目标
- 多模型AI集成
- 智能诊断助手
- 医疗知识图谱
- 患者社区建设

## 7. 风险评估

1. 数据安全风险
   - 患者隐私保护
   - 医疗数据合规

2. 系统稳定性风险
   - 高并发处理
   - 数据一致性

3. AI服务风险
   - 建议准确性
   - API依赖性

4. 合规风险
   - 医疗法规遵从
   - 数据保护条例